# 📦 一、什么是 Sequelize？


**Sequelize** 是一个 Node.js 的 **ORM（对象关系映射）库**，支持多种数据库：

* MySQL / MariaDB
* PostgreSQL
* SQLite
* Microsoft SQL Server

> 使用 Sequelize，你可以像操作 JavaScript 对象一样操作数据库。

---

# 🧱 二、ORM 原理简述

ORM 将 **表映射为类**，**行映射为实例**，**字段映射为属性**。


| 数据库术语      | ORM 映射术语 |
| ---------- | -------- |
| Table      | Model 类  |
| Row        | Model 实例 |
| Column     | 属性（字段）   |
| ForeignKey | 关联关系     |

---

# 🚀 三、安装

```bash
npm install sequelize mysql2
```

> 安装 mysql2 是因为 Sequelize 本身不带数据库驱动。

---

# ✍️ 四、快速上手示例

```js
const { Sequelize, DataTypes } = require('sequelize');

// 创建连接
const sequelize = new Sequelize('sequelize_db', 'root', 'root', {
  host: 'localhost',
  dialect: 'mysql'
});

// 定义模型
cosnt User = sequelize.define('User', {
    id: {type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true},
    username: {type: DataTypes.STRING},
    email: {type: DataTypes.STRING}
})

// 同步表结构
async function main() {
    await sequelize.sync();
    // 创建实例 插入数据
    const user = await User.create({username: 'tom', email: 'tom@example.com'});
    console.log(user.toJSON());
}

main();
```
    
---

# 🧰 五、核心模块及常用方法

---

## ✅ 1. Sequelize 实例（数据库连接）

```js
const sequelize = new Sequelize(database, username, password, options)
```

### 常用属性 & 方法：

| 方法 / 属性                    | 说明       |
| -------------------------- | -------- |
| `sequelize.authenticate()` | 测试数据库连接  |
| `sequelize.sync()`         | 同步模型（建表） |
| `sequelize.transaction()`  | 执行事务     |
| `sequelize.define()`       | 定义模型     |
| `sequelize.models`         | 所有模型集合   |

---

## ✅ 2. Model（模型类）

定义表结构，对应数据库表。

```js
const User = sequelize.define('User', {
    name: DataTypes.STRING,
    age: DataTypes.INTEGER,
    email: DataTypes.STRING
});
```

### 实例方法：

| 方法                  | 说明     |
| ------------------- | ------ |
| `User.create()`     | 创建记录   |
| `User.findAll()`    | 查询所有记录 |
| `User.findOne()`    | 查询一条   |
| `User.findByPk()`   | 通过主键查询 |
| `User.update()`     | 批量更新   |
| `User.destroy()`    | 批量删除   |
| `User.count()`      | 统计数量   |
| `User.bulkCreate()` | 批量插入   |

---

### 查询条件语法：

```js
User.findAll({
    where: {
        age: { [Op.gt]: 18 },
        name: { [Op.like]: '%tom%' }
    },
    limit: 10,
    order: [['createdAt', 'DESC']]
});
```

> Sequelize 的查询使用 **操作符（Op）**：               

```js
const { Op } = require('sequelize');

{
  [Op.gt]: 10,       // >
  [Op.gte]: 10,      // >=
  [Op.like]: '%abc%' // 模糊匹配
}
```


| 操作符           | 说明        | 示例                                             |
| ------------- | --------- | ---------------------------------------------- |
| `Op.eq`       | 等于        | `{ age: { [Op.eq]: 18 } }`                     |
| `Op.ne`       | 不等于       | `{ age: { [Op.ne]: 18 } }`                     |
| `Op.gt / gte` | 大于 / 大于等于 | `{ age: { [Op.gt]: 20 } }`                     |
| `Op.in`       | 包含在数组中    | `{ id: { [Op.in]: [1, 2, 3] } }`               |
| `Op.or`       | 或关系       | `[ { title: {...} }, { description: {...} } ]` |
| `Op.and`      | 与关系       | `[ { status: 1 }, { deleted: false } ]`        |
| `Op.like`     | 模糊匹配      | `{ title: { [Op.like]: '%Vue%' } }`            |


---

## ✅ 3. DataTypes（数据类型）

| Sequelize 类型 | 对应 MySQL 类型 |
| ------------ | ----------- |
| `STRING`     | VARCHAR     |
| `TEXT`       | TEXT        |
| `INTEGER`    | INT         |
| `BOOLEAN`    | TINYINT(1)  |
| `DATE`       | DATETIME    |
| `FLOAT`      | FLOAT       |
| `DECIMAL`    | DECIMAL     |

---

## ✅ 4. 关联关系（关系型映射）

### 一对一：

```js

User.hasOne(Profile)
Profile.belongsTo(User)

```

### 一对多：

```js
User.hasMany(Post)
Post.belongsTo(User)
```

### 多对多：

```js
User.belongsToMany(Role, { through: 'UserRoles' }) // 用户和角色多对多关系 UserRoles 中间表
Role.belongsToMany(User, { through: 'UserRoles' });
```

---

# 📁 六、完整 CRUD 示例

```js
// 添加
await User.create({ username: 'tom', email: 't@t.com' })
// 查询  
const users = await User.findAll({ where: { usename:'tom'}})

// 更新
await User.update({username:'tom'},{where:{id:1}})


// 删除
await User.destroy({where:{id:1}})
     
```

---

# 📁 七、事务处理

```js

const t = await sequelize.transaction()

try{
    await User.create({ username: 'tom', email: 't@t.com' }, { transaction: t })
    await Profile.create({ userId: 1}, { transaction: t })
    await t.commit()
} catch (error){
    await t.rollback()
}


```

# 🌐 八、使用场景

| 场景               | 用法                        |
| ---------------- | ------------------------- |
| Web 应用接口开发       | 基础 CRUD、分页、查询、排序          |
| 后台管理系统           | 表单添加修改、列表查询               |
| 多表查询和统计          | 模型关联、聚合函数                 |
| 项目中快速开发 MVP 模型层  | 通过模型建表、定义业务实体             |
| API 返回 JSON 格式数据 | Sequelize 查询返回的就是 JSON 对象 |




