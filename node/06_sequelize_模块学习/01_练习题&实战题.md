# 🎯 九、练习题 & 实战题

---

## 📝 应用题

1. Sequelize 的 `sync()` 和 `sync({ force: true })` 有什么区别？
    - 📌 作用：
        - `sync()`：用于根据你定义的模型结构，在数据库中创建对应的数据表
        - 是 Sequelize 的一种「自动建表/同步机制」

| 方法                                | 含义             | 会清空原表数据？ | 使用场景          |
| --------------------------------- | -------------- | -------- | ------------- |
| `sequelize.sync()`                | 若表不存在则创建       | ❌ 不会     | 正式环境、安全同步     |
| `sequelize.sync({ force: true })` | 每次先**删除原表再重建** | ✅ 会清空    | 开发调试阶段，快速修改结构 |




2. `create()` 和 `build()` 的区别？

| 方法         | 含义              | 会立即写入数据库？ | 使用场景                  |
| ---------- | --------------- | --------- | --------------------- |
| `build()`  | 创建一个模型实例（只在内存中） | ❌ 否       | 需要先修改再保存，比如验证逻辑、加工数据等 |
| `create()` | 创建实例并立即保存到数据库   | ✅ 是       | 一步完成新增数据（最常用）         |

```js
// build：先构造对象
const user = User.build({ username: 'alice' });
user.email = 'alice@example.com';
await user.save(); // 手动保存

// create：直接插入
await User.create({ username: 'bob', email: 'bob@example.com' });

```


3. 如何定义模型字段为唯一索引？如何设置默认值？
```js
const User = sequelize.define('User', {
    username: {
        type: DataTypes.STRING,
        unique: true,
        allowNull: false
    },
    status: {
        type: DataTypes.ENUM('active', 'inactive'),
        defaultValue: 'active'
    },
    create_at: {
        type: DataTypes.DATE,
        defaultValue: DataTypes.NOW 
    }
})



```

4. 如何使用 Sequelize 实现分页查询？
```js
cosnt page = 2
const pageSize = 10
const {count, rows: users} = await User.findAndCountAll({
    offset: (page - 1) * pageSize,
    limit: pageSize,
    order: [['createdAt', 'DESC']]
})



```

---

## 🧪 实战题

---

### ✅ 题目 1：定义用户表模型 `User`

字段包括：

| 字段       | 类型      | 限制     |
| -------- | ------- | ------ |
| id       | INTEGER | 主键、自增  |
| username | STRING  | 唯一、非空  |
| email    | STRING  | 可空     |
| age      | INTEGER | 默认值 18 |

---

```js
const User = sequelize.define('User', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    username: {
        type: DataTypes.STRING,
        unique: true,
        allowNull: false
    },
    email: {
        type: DataTypes: STRING,
        allowNull: true
    },
    age: {
        type: DataTypes.INTEGER,
        defaultValue: 18
    }
})

const Post = sequelize.define('Post', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    title: DataTypes.STRING,
    content: DataTypes.TEXT,

})

```

### ✅ 题目 2：实现用户 CRUD 操作

```js
createUser({ username, email })
getUserById(id)
updateUser(id, newData)
deleteUser(id)

const createUser = async ({username, email}) => {
    const user = await User.create({username, email})
    return user
}
const getUserById = async (id) => {
    const user = await User.findByPk(id)
    return user
}
const updateUser = async (id, newData) => {
    const user = await User.findByPk(id)
    if(!user) {
        return null
    }
    return await user.update(newData)
}
const deleteUser = async (id) => {
    const user = await User.findByPk(id)
    if(!user) {
        return null
    }
    await user.destroy()
    return true
}

```


---

### ✅ 题目 3：实现分页和模糊查询
    功能：分页返回用户列表，可根据 `username` 模糊搜索。

```js
getUsersByPage(page, pageSize, keyword)

const getUserByPage = async (page = 1, pageSize = 10, keyword) {
    const offset = (page - 1) * pageSize
    return await Post.findAndCountAll({
        where: keyword ? {
            username: {
                [Op.like]: `%${keyword}%`
            }
        },
        offset,
        limit: pageSize
    })
}

```


---

### ✅ 题目 4：定义 `User` 和 `Post` 的一对多关系

* 一个用户可以拥有多个帖子
* 查询某个用户的所有帖子
* 查询某篇帖子所属用户

```js
User.hasMany(Post)
Post.belongsTo(User)
// 查询某个用户的所有帖子
const getPostsByUser = async (userId) => {
    const user = await User.findByPk(userId, {
        include: [{
            model: Post,
            as: 'posts'
        }]
    })
    return user ? user.posts : null
}

// 查询某篇帖子所属用户
const getUserByPost = async (postId) => {
    const post = await Post.findByPk(postId, {
        include: [{
            model: User,
            as: 'user'
        }]
    })
    return post ? post.user : null
}

```
---

### ✅ 题目 5：构建事务处理

* 用户注册时同时创建用户信息和其默认配置
* 任意操作失败，整个回滚

```js
const registerUser = sequelize.transaction(async (t) => {
    const user = await User.create({
        username,
        email
    }, {transaction: t})
    
})
const registerUserWithDefaultConfig = async () => {
    const t = await sequelize.transaction()
    try {
        const user = await User.create({ username, email }, { transaction: t })
        await Post.create({title: '欢迎贴', content: '欢迎来到我们的社区', userId: user.id}, { transaction: t })
        await t.commit()
        return user
    } catch (error) {
        await t.rollback()
        throw error
    }
}

```

---

# 📘 十、推荐学习资源

* 官方文档：[https://sequelize.org](https://sequelize.org)
* 中文文档（社区维护）：[https://sequelize.cn](https://sequelize.cn)
* GitHub 示例项目：[https://github.com/sequelize/express-example](https://github.com/sequelize/express-example)
* TypeORM（另一个流行 ORM）对比参考：[https://typeorm.io](https://typeorm.io)

---

是否需要我为你实现上面的某一题完整代码示例？或者结合 Express、JWT、Sequelize 构建一整套 RESTful API 登录系统？欢迎继续提问，我可以手把手带你做完整项目。
