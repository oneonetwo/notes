# HTTP协议
> 超文本传输协议 Hyper Text Transfer Protocol  
  [思维导图](https://static001.geekbang.org/resource/image/27/cc/2781919e73f5d258ff1dc371af632acc.png)
### 前言 
1. HTTP是什么，不是什么
   - HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范
2. http前世今生
    - 前期诞生
      > 1. URI：即统一资源标识符，作为互联网上资源的唯一身份；
      > 2. HTML：即超文本标记语言，描述超文本文档；
      > 3. HTTP：即超文本传输协议，用来传输超文本。
    - http/0.9
      > 1. 只允许用“GET”动作从服务器上获取 HTML 文档，并且在响应请求之后立即关闭连接，功能非常有限。
    - HTTP/1.0
      > 1. 增加了 HEAD、POST 等新方法；
      > 2. 增加了响应状态码，标记可能的错误原因；
      > 3. 引入了协议版本号概念；
      > 4. 引入了 HTTP Header（头部）的概念，让 HTTP 处理请求和响应更加灵活；
      > 5. 传输的数据不再仅限于文本。
    - HTTP/1.1
      > 1. 增加了 PUT、DELETE 等新的方法；
      > 2. 增加了缓存管理和控制；
      > 3. 明确了连接管理，允许持久连接；
      > 4. 允许响应数据分块（chunked），利于传输大文件；
      > 5. 强制要求 Host 头，让互联网主机托管成为可能。
    - HTTP/2.0
      > 1. 二进制协议，不再是纯文本；
      > 2. 可发起多个请求，废弃了 1.1 里的管道；
      > 3. 使用专用算法压缩头部，减少数据传输量；
      > 4. 允许服务器主动向客户端推送数据；
      > 5. 增强了安全性，“事实上”要求加密通信。      
3. 概念
    - 浏览器: 浏览器是 HTTP 协议里的请求方，即 User Agent；
    - Web 服务器: HTTP 协议里的应答方，常用的有 Apache 和 Nginx；
    - CDN, 全称是“Content Delivery Network”，翻译过来就是“内容分发网络”。它应用了 HTTP 协议里的缓存和代理技术，代替源站响应客户端的请求。
    - 爬虫， 是另一类 User Agent，是自动访问网络资源的程序。
    - HTML，是超文本标记语言，使用各种标签描述文字、图片、超链接等资源，并且可以嵌入 CSS、JavaScript 等技术实现复杂的动态效果，复杂的非线性、网状的结构关系，再经过浏览器的解释，呈现在我们面前的就是一个含有多种视听信息的页面
    - WebService，一个基于 Web（HTTP）的服务架构技术，既可以运行在内网，也可以在适当保护后运行在外网。
    - WAF，网络应用防火墙，它是应用层面的“防火墙”，专门检测 HTTP 流量，是防护 Web 应用的安全技术。
### HTTP相关协议
1. TCP/IP协议
    -  TCP/IP 协议实际上是一系列网络通信协议的统称，其中最核心的两个协议是 TCP 和 IP，
    -  IP 协议是“Internet Protocol”的缩写，主要目的是解决寻址和路由问题，以及如何在两点间传送数据包。
    -  TCP 协议是“Transmission Control Protocol”的缩写，意思是“传输控制协议”，它位于 IP 协议之上，基于 IP 协议提供可靠的、字节流形式的通信，是 HTTP 协议得以实现的基础。
    -  HTTP 是一个"传输协议"，但它不关心寻址、路由、数据完整性等传输细节，而要求这些工作都由下层来处理。因为互联网上最流行的是 TCP/IP 协议，而它刚好满足 HTTP 的要求，所以互联网上的 HTTP 协议就运行在了 TCP/IP 上，HTTP 也就可以更准确地称为“HTTP over TCP/IP”。
2. DNS 为了方便访问互联网上的 Web 服务器，通常都会使用 DNS 来定位或标记主机名，间接地把 DNS 与 HTTP 绑在了一起。
3. URI/URL
    - URI（Uniform Resource Identifier），中文名称是 统一资源标识符，使用它就能够唯一地标记互联网上资源。
    - URL（Uniform Resource Locator）， 统一资源定位符，也就是我们俗称的“网址”
4. HTTPS
    - 全称是 “HTTP over SSL/TLS”，也就是运行在 SSL/TLS 协议上的 HTTP。
    - SSL 使用了许多密码学最先进的研究成果，综合了对称加密、非对称加密、摘要算法、数字签名、数字证书等技术，能够在不安全的环境中为通信的双方创建出一个秘密的、安全的传输通道，为 HTTP 套上一副坚固的盔甲。
5. 代理
    - 代理有很多的种类，常见的有：
      > 1. 匿名代理：完全“隐匿”了被代理的机器，外界看到的只是代理服务器；
      > 2. 透明代理：顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客户端；
      > 3. 正向代理：靠近客户端，代表客户端向服务器发送请求；
      > 4. 反向代理：靠近服务器端，代表服务器响应客户端的请求； 
    - 由于代理在传输过程中插入了一个“中间层”，所以可以在这个环节做很多有意思的事情，比如：
      > 1. 负载均衡：把访问请求均匀分散到多台机器，实现访问集群化；
      > 2. 内容缓存：暂存上下行的数据，减轻后端的压力；
      > 3. 安全防护：隐匿 IP, 使用 WAF 等工具抵御网络攻击，保护被代理的机器；
      > 4. 数据处理：提供压缩、加密等额外的功能。
      
### 经典网络分层模型   
1. 物理层, 网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 数据链路层, 负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次 ,使用 MAC 地址来标记网络上的设备
3. 网络层, IP 协议就处在这一层,用 IP 地址取代 MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络
4. 传输层,这个层次协议的职责是保证数据在 IP 地址标记的两点之间“可靠”地传输，是 TCP 协议工作的层次，另外还有它的一个“小伙伴”UDP。
5. 应用层,例如 Telnet、SSH、FTP、SMTP 等等，当然还有我们的 HTTP。

### 基础篇

1. 浏览器按下回车键，发生了什么？
      - 首先浏览器看需不需要redirect（有可能浏览器已经做了记录），需要redirect到哪里 ,
      - 第二步去看app cache 是否有缓存，然后去请求资源，
      - 经过DNS解析，获取IP后，
      - 创建TCP链接，经过TCP三次握手（如果是https则跟tcp不一样)
      - 建立 TCP 连接后会顺序收发数据，请求方和应答方都必须依据 HTTP 规范构建和解析报文
      - 浏览器解析报文，渲染输出页面。
2. HTTP报文
        ![alt 请求报文](https://static001.geekbang.org/resource/image/b1/df/b191c8760c8ad33acd9bb005b251a2df.png)
      - 请求行 `GET /HTTP/1.1`
      - 状态行 `HTTP/1.1 200 OK`
      - 起始行和头部字段经常又合称为“请求头”或“响应头”，消息正文又称为“实体”，但与“header”对应，很多时候就直接称为“body”。
      
3. 请求方法
> 请求的方法 GET head POST  PUT patch trace  options 
      - GET：获取资源，可以理解为读取或者下载数据；
      - HEAD：方法与 GET 方法类似,但服务器不会返回请求的实体数据，只会传回响应头，也就是资源的“元信息”
      - POST：发送数据给服务器.更新数据；
      - PUT：类似 POST,用于新增资源调用一次与连续调用多次是等价的（即没有副作用）；
      - Get跟Post区别
         > 1. http定义的语义化的请求方法get获取数据，post发送数据给服务器
         > 2. get参数通过url传递，post放在request body中，所以get请求在传递的参数是有长度限制的，post没有，可以上传数据文件
         > 3. Get是不安全的，因为在传输过程，数据被放在请求的URL中，而如今现有的很多服务器、代理服务器或者用户代理都会将请求URL记录到日志文件中，然后放在某个地方，这样就可能会有一些隐私的信息被第三方看到。另外，用户也可以在浏览器上直接看到提交的数据，一些系统内部消息将会一同显示在用户面前。Post的所有操作对用户来说都是不可见的。
         > 4. get请求会浏览器主动cache，保留在浏览历史记录里，而post中的参数不会被保留。


  
  
